import * as React from "react";
import boll from "bollinger-bands";

var train_loss_1 = [
  10.602765083312988, 6.8239617347717285, 6.803394317626953, 7.496392726898193,
  7.224035263061523, 6.176591873168945, 5.771305561065674, 5.343344688415527,
  5.311799049377441, 4.830101490020752, 5.093681335449219, 5.093090057373047,
  4.02071475982666, 4.376315593719482, 4.663816452026367, 4.232067584991455,
  3.873750686645508, 3.8876543045043945, 4.14309024810791, 3.620633125305176,
  3.5116748809814453, 3.469700574874878, 3.630825996398926, 3.162926197052002,
  3.179630994796753, 3.1384482383728027, 2.9381511211395264, 3.3347511291503906,
  3.5266523361206055, 2.833322525024414, 3.0612215995788574, 3.059727430343628,
  2.8458809852600098, 2.961834192276001, 2.5302186012268066, 2.651209831237793,
  2.57136869430542, 2.677370548248291, 2.7456631660461426, 2.6504099369049072,
  2.4740257263183594, 2.733332633972168, 2.551811933517456, 2.566788673400879,
  2.538564443588257, 2.4174585342407227, 2.4043235778808594, 2.3033530712127686,
  2.483088731765747, 2.2974419593811035, 2.282388210296631, 2.6492559909820557,
  2.4813485145568848, 2.016273021697998, 2.0286998748779297, 2.133023738861084,
  2.3431406021118164, 2.33589506149292, 2.0659995079040527, 2.0748579502105713,
  2.0516929626464844, 1.9548842906951904, 2.0693578720092773,
  2.1272196769714355, 1.7803003787994385, 2.081364154815674, 1.9563403129577637,
  1.8146061897277832, 1.9684312343597412, 2.0100386142730713,
  1.8026175498962402, 1.9672212600708008, 1.8555492162704468, 2.103579044342041,
  1.895423412322998, 1.7742432355880737, 1.7248055934906006, 1.8154661655426025,
  1.8723564147949219, 2.0272231101989746, 1.7635647058486938, 1.762131929397583,
  1.8838489055633545, 1.9690375328063965, 1.6350595951080322, 1.720747947692871,
  1.7455636262893677, 1.6699457168579102, 1.8273144960403442, 1.777660846710205,
  1.4546846151351929, 1.493948221206665, 1.6642155647277832, 1.7894268035888672,
  1.6410367488861084, 1.7706903219223022, 1.622438907623291, 1.5813748836517334,
  1.6716762781143188, 1.588024616241455, 1.5100059509277344, 1.5793886184692383,
  1.5219649076461792, 1.5014259815216064, 1.571689248085022, 1.4278813600540161,
  1.334093451499939, 1.5681631565093994, 1.743251085281372, 1.5184507369995117,
  1.7927930355072021, 1.6935049295425415, 1.494010329246521, 1.6864537000656128,
  1.3354434967041016, 1.5241639614105225, 1.6030067205429077,
  1.3241595029830933, 1.4924085140228271, 1.3164926767349243,
  1.2498263120651245, 1.2735131978988647, 1.4158642292022705,
  1.5900776386260986, 1.4066598415374756, 1.1879658699035645,
  1.4151484966278076, 1.5417249202728271, 1.4782626628875732, 1.382091999053955,
  1.5170714855194092, 1.288292407989502, 1.4237734079360962, 1.3452317714691162,
  1.5303494930267334, 1.1787681579589844, 1.4647010564804077,
  1.2909481525421143, 1.5113990306854248, 1.1827073097229004,
  1.4292125701904297, 1.1862192153930664, 1.218196988105774, 1.266378402709961,
  1.3081945180892944, 1.6857614517211914, 1.2668251991271973, 1.229108452796936,
  1.232999563217163, 1.3392400741577148,
];

var test_loss_1 = [
  5.923416614532471, 6.838003158569336, 7.908254623413086, 7.0218892097473145,
  5.427967071533203, 5.4879937171936035, 5.192581653594971, 4.405584335327148,
  6.328897476196289, 4.807779788970947, 4.859450817108154, 4.657627105712891,
  4.375256538391113, 4.23723030090332, 4.251441955566406, 4.045469284057617,
  4.135866165161133, 4.077445983886719, 4.135012626647949, 4.100460052490234,
  4.115657329559326, 4.199411392211914, 4.225943565368652, 4.615872383117676,
  4.58229398727417, 4.931792259216309, 4.888819694519043, 4.40023136138916,
  4.232775688171387, 3.87642765045166, 3.672370433807373, 3.8345112800598145,
  3.8439769744873047, 4.2555928230285645, 4.030305862426758, 4.235048294067383,
  4.848349094390869, 4.645198822021484, 4.7390947341918945, 4.227827548980713,
  4.48564338684082, 4.305177211761475, 3.4777069091796875, 3.4289050102233887,
  4.228448867797852, 3.4736804962158203, 3.849550724029541, 4.134728908538818,
  3.691699981689453, 4.825376510620117, 4.1761956214904785, 3.894368886947632,
  3.7100777626037598, 3.2676002979278564, 3.2930994033813477, 3.802464008331299,
  4.202944278717041, 2.8375468254089355, 3.601655960083008, 4.584174156188965,
  3.0332820415496826, 3.6054766178131104, 2.5175201892852783,
  3.7963461875915527, 2.448918342590332, 3.8796300888061523, 2.4918341636657715,
  4.234950065612793, 4.046641826629639, 4.147903919219971, 4.1024088859558105,
  3.9581921100616455, 3.813908100128174, 3.6246941089630127, 3.5440311431884766,
  3.502368927001953, 3.416013240814209, 3.337329864501953, 3.436354160308838,
  3.4775562286376953, 3.5398521423339844, 3.5070583820343018,
  3.7494802474975586, 3.504563331604004, 3.4296891689300537, 3.3892741203308105,
  3.512974739074707, 3.702357053756714, 3.625107765197754, 3.5630791187286377,
  3.4822797775268555, 3.5138044357299805, 3.298476219177246, 3.2124319076538086,
  3.075654983520508, 3.185451030731201, 3.228611707687378, 3.2266077995300293,
  3.267576217651367, 3.432016372680664, 3.4095451831817627, 3.3958992958068848,
  3.4679412841796875, 3.3713748455047607, 3.3476333618164062,
  3.3600502014160156, 3.525919198989868, 3.501178741455078, 3.433344602584839,
  3.4199461936950684, 3.450234889984131, 3.385836362838745, 3.408956527709961,
  3.327888011932373, 3.204784870147705, 3.1063761711120605, 3.166928768157959,
  3.300842761993408, 3.193936347961426, 3.260246515274048, 3.2494425773620605,
  3.3646202087402344, 3.4086716175079346, 3.429919719696045, 3.6489386558532715,
  3.663343667984009, 3.676447629928589, 3.8241701126098633, 3.7315359115600586,
  3.751218318939209, 3.4721827507019043, 3.490588665008545, 3.3592567443847656,
  3.5605969429016113, 3.484401226043701, 3.440065622329712, 3.6395249366760254,
  3.591747283935547, 3.7368826866149902, 3.7206268310546875, 3.944425344467163,
  3.8486194610595703, 4.065608978271484, 4.0609612464904785, 3.8122260570526123,
  3.6483068466186523, 3.5248184204101562, 3.4241364002227783, 3.297437906265259,
  3.3763372898101807,
];

var train_loss_2 = [
  15.319585800170898, 7.859868049621582, 6.402109622955322, 5.778112888336182,
  6.865719318389893, 6.654834270477295, 6.259149551391602, 5.4810686111450195,
  5.4367265701293945, 5.314399719238281, 5.286607265472412, 4.632961273193359,
  4.849035263061523, 4.816623687744141, 4.102310657501221, 4.452566623687744,
  3.899001121520996, 3.830695629119873, 3.838414430618286, 3.740194797515869,
  3.511725425720215, 3.56081485748291, 3.610267162322998, 3.083483934402466,
  3.116981267929077, 2.9536221027374268, 3.1735663414001465, 3.235846757888794,
  2.715102434158325, 2.699148178100586, 2.9190168380737305, 2.9346611499786377,
  2.600532293319702, 2.3021507263183594, 2.2247214317321777, 2.665790557861328,
  2.602595806121826, 2.1604654788970947, 2.012899160385132, 2.1874167919158936,
  2.093400001525879, 1.9042623043060303, 2.013685703277588, 1.7797062397003174,
  2.153163194656372, 1.9144530296325684, 1.713221788406372, 1.867891550064087,
  1.7236666679382324, 1.7477788925170898, 1.6060469150543213,
  1.7855021953582764, 3.116255760192871, 1.8649176359176636, 1.593522071838379,
  1.7185883522033691, 1.6801342964172363, 1.4689666032791138, 1.803497076034546,
  1.612863540649414, 1.7387657165527344, 1.6873724460601807, 1.4902539253234863,
  1.3714667558670044, 1.5654411315917969, 1.6645958423614502,
  1.6323330402374268, 1.3620485067367554, 1.4313950538635254,
  1.7135677337646484, 1.6806951761245728, 1.6166682243347168,
  1.3139277696609497, 1.6254693269729614, 1.7464773654937744,
  1.3689818382263184, 1.2180994749069214, 1.556854248046875, 1.2797881364822388,
  1.467445731163025, 1.4349918365478516, 1.2332916259765625, 1.4052677154541016,
  1.3922017812728882, 1.1897053718566895, 1.4756304025650024,
  1.3247122764587402, 1.1991997957229614, 1.5057826042175293, 1.063131332397461,
  1.392939567565918, 1.1960521936416626, 1.1625487804412842, 1.166563630104065,
  1.5114192962646484, 1.2752494812011719, 1.147773265838623, 1.1181453466415405,
  1.1693480014801025, 0.9767880439758301, 1.1808624267578125,
  1.2655632495880127, 1.1544950008392334, 1.089709758758545, 0.986761212348938,
  1.0145436525344849, 1.1508768796920776, 1.1517722606658936, 1.353722095489502,
  1.0203176736831665, 1.0769356489181519, 1.0062453746795654,
  0.9657014012336731, 1.0178725719451904, 1.399497628211975, 1.3644993305206299,
  1.0741214752197266, 1.0345834493637085, 1.0139082670211792,
  1.0124891996383667, 0.8661009669303894, 0.9273117780685425,
  0.9798522591590881, 1.326388955116272, 1.018290638923645, 1.0098402500152588,
  0.9178674221038818, 0.9193719029426575, 1.0746660232543945,
  1.2317765951156616, 0.9682436585426331, 1.042323112487793, 1.015373945236206,
  0.9795389175415039, 0.9741485714912415, 0.9853798151016235,
  1.1417711973190308, 1.121023416519165, 0.9667951464653015, 1.004364252090454,
  0.8531500697135925, 0.9933969378471375, 0.9944455623626709, 0.895115077495575,
  1.2200372219085693, 0.9954578280448914, 0.9897552728652954, 1.298666000366211,
  1.112990140914917, 0.9295119047164917, 1.0087050199508667, 0.9567420482635498,
  1.0745680332183838, 1.095737099647522, 1.003524661064148, 0.9611824750900269,
  1.071912169456482, 0.8967042565345764, 0.8838862180709839, 0.9163045883178711,
  1.0630284547805786, 0.9070264101028442, 1.117685317993164, 0.949146568775177,
  0.8830968141555786, 0.9752777814865112, 1.1384100914001465, 1.042222499847412,
  0.8708034157752991, 0.8994665741920471, 1.19346022605896, 0.9882426857948303,
  0.9906045794487, 0.952764630317688, 0.8386295437812805, 0.8595671653747559,
  0.9210282564163208, 1.127123236656189, 0.9245892763137817, 0.976987898349762,
  0.9568488597869873, 0.9361914396286011, 0.8474688529968262,
  0.9039607048034668, 0.8553151488304138, 1.0205963850021362,
  0.9025694727897644, 0.8485374450683594, 0.8687409162521362,
  0.9834059476852417, 0.8521368503570557, 0.9027634263038635,
  0.8567438721656799, 0.8997242450714111, 0.8565613627433777,
  0.8995451927185059, 0.8370951414108276, 0.8635190725326538,
  0.8921340703964233, 0.9982043504714966, 1.2494454383850098,
  0.8454731106758118, 0.9197214841842651, 0.8357227444648743,
  0.9686744213104248, 0.8374348878860474, 0.9418121576309204, 0.834480345249176,
  0.86646568775177, 0.8395707607269287, 0.8311290144920349, 1.0439084768295288,
  0.9509426355361938, 1.159207820892334, 0.9258590340614319, 0.8523778915405273,
  1.0281202793121338, 1.0480605363845825, 0.8601446151733398,
  0.8923834562301636, 0.8492054343223572, 0.8908293843269348,
  0.9256594777107239, 1.1553740501403809, 0.9259141683578491,
  1.1561102867126465, 0.9213616847991943, 0.9274587035179138,
  1.1969702243804932, 0.8398392200469971, 0.8450680375099182,
  0.8564006686210632, 0.9071899652481079, 0.8533105850219727,
  0.8821157813072205, 0.9804084300994873, 0.8392539620399475,
  0.9020505547523499, 0.84797203540802, 0.9202226996421814, 0.8714593648910522,
  1.0988802909851074, 0.9935706853866577, 1.129563570022583, 0.8637223243713379,
  0.9536846876144409, 0.8262779712677002, 1.0072345733642578,
  0.8946416974067688, 0.8455759286880493, 0.901536226272583, 0.8414638638496399,
  0.833760678768158, 0.8601294159889221, 0.9585251212120056, 0.9036310315132141,
  0.9557592868804932, 0.9600116014480591, 0.9257513880729675,
  0.8704045414924622, 0.9145546555519104, 0.9097424745559692, 0.857476532459259,
  1.0584068298339844, 0.9540326595306396, 0.9476672410964966,
  0.8635283708572388, 1.0630096197128296, 0.9896718263626099,
  0.8286694884300232, 0.8938668966293335, 0.8268265128135681,
  0.8418237566947937, 0.8520740270614624, 0.9126766324043274,
  0.8790363669395447, 0.9249398708343506, 0.9449769258499146,
  1.0043866634368896, 0.8662664890289307, 0.9191604852676392,
  0.9302197694778442, 0.903419017791748, 0.828464686870575, 0.8348798155784607,
  0.8689025044441223, 0.9013499021530151, 0.8220311403274536,
  0.8520628809928894, 0.9049964547157288, 0.8385302424430847,
  0.9079335927963257, 0.8203350305557251, 0.9068565964698792,
  0.8371110558509827, 0.8581615686416626, 1.0546494722366333,
  0.9622563123703003, 0.8207712769508362, 0.8643059730529785,
];

var test_loss_1 = [
  7.514692783355713, 6.046333312988281, 6.4915642738342285, 7.77206563949585,
  7.428395748138428, 7.360838413238525, 6.40643835067749, 6.190240383148193,
  5.413424968719482, 5.204930305480957, 4.355325698852539, 4.595491886138916,
  4.691741943359375, 4.056697368621826, 3.7062740325927734, 3.9300756454467773,
  4.518749713897705, 3.8880727291107178, 4.102088451385498, 3.9234631061553955,
  3.9014174938201904, 3.876613140106201, 3.5962443351745605, 3.5467214584350586,
  3.416729688644409, 3.4106717109680176, 3.3501994609832764, 3.3660290241241455,
  3.2814395427703857, 3.2544288635253906, 3.1124494075775146, 3.148587226867676,
  3.1154110431671143, 3.2079548835754395, 3.1631975173950195,
  3.2572555541992188, 3.231041669845581, 3.808786630630493, 3.610475778579712,
  3.636957883834839, 3.2761473655700684, 3.3719305992126465, 3.2739500999450684,
  3.193141460418701, 3.222745895385742, 3.1204333305358887, 3.110739231109619,
  3.1203203201293945, 3.1180849075317383, 3.31022310256958, 3.6838314533233643,
  3.394049882888794, 3.2567529678344727, 3.3841400146484375, 3.158358573913574,
  3.487079620361328, 3.419457197189331, 3.499746561050415, 3.4103941917419434,
  3.467154026031494, 3.459791421890259, 2.9575700759887695, 3.1663970947265625,
  3.350287437438965, 3.4115164279937744, 3.2111668586730957, 3.3619894981384277,
  3.5891714096069336, 2.9951999187469482, 3.603900909423828, 3.123546600341797,
  3.2289793491363525, 3.425380229949951, 3.5864903926849365, 3.6218366622924805,
  3.796541452407837, 4.018857955932617, 4.304403781890869, 3.758366823196411,
  3.208779811859131, 3.512399673461914, 3.8778421878814697, 3.517094612121582,
  3.039198875427246, 3.6461098194122314, 3.310192584991455, 3.523127555847168,
  3.669274091720581, 3.1211657524108887, 3.2338411808013916, 3.6005544662475586,
  3.441101551055908, 3.594853401184082, 3.175583839416504, 3.562079429626465,
  3.1885666847229004, 3.176375389099121, 3.2927589416503906, 3.278306484222412,
  3.523101806640625, 2.8009822368621826, 5.484718322753906, 3.223479747772217,
  3.0918052196502686, 3.1235737800598145, 3.0407304763793945,
  2.9671099185943604, 3.189767360687256, 3.9151246547698975, 4.910787582397461,
  3.9580516815185547, 3.2256317138671875, 3.13433837890625, 4.467116355895996,
  2.930067300796509, 2.782850980758667, 2.6058011054992676, 2.959801435470581,
  3.4411568641662598, 3.4352335929870605, 3.899435520172119, 3.7379794120788574,
  6.215732097625732, 3.1027534008026123, 4.074190139770508, 4.925583839416504,
  11.623709678649902, 3.1042404174804688, 3.511183261871338, 2.6886250972747803,
  4.112400054931641, 11.334257125854492, 3.8054118156433105, 2.6797945499420166,
  4.236503601074219, 4.459912300109863, 4.231573104858398, 4.4583048820495605,
  4.459028720855713, 4.280717849731445, 4.413186550140381, 4.567511081695557,
  4.9748711585998535, 5.441158294677734, 5.368760585784912, 5.213782787322998,
  4.959281921386719, 4.7456512451171875, 5.00648307800293, 4.6616387367248535,
  4.519170761108398, 4.4678239822387695, 4.305624961853027, 4.355730056762695,
  4.58836555480957, 4.13223123550415, 4.345666885375977, 4.5253167152404785,
  4.522000789642334, 4.820242404937744, 4.772437572479248, 4.700431823730469,
  5.331596851348877, 4.949521541595459, 5.323493957519531, 4.784757137298584,
  5.578967094421387, 5.08662223815918, 5.357993125915527, 5.288894176483154,
  6.125348091125488, 5.083990097045898, 5.236403465270996, 5.0549774169921875,
  5.188288688659668, 4.954543113708496, 4.852492332458496, 5.200531482696533,
  5.220163345336914, 5.1728596687316895, 5.225454807281494, 5.345027923583984,
  5.046324253082275, 5.325551986694336, 4.873724937438965, 5.516334533691406,
  5.504390716552734, 5.097329139709473, 5.236886978149414, 4.929747581481934,
  5.665162086486816, 5.535645961761475, 5.310602188110352, 5.490438461303711,
  5.637989044189453, 5.228637218475342, 5.527307033538818, 5.903547286987305,
  5.188251495361328, 5.210079193115234, 5.464578628540039, 5.568095684051514,
  5.634861469268799, 5.506227970123291, 5.354877948760986, 5.683637619018555,
  5.516636371612549, 5.692855358123779, 5.806491851806641, 6.372236728668213,
  5.695518493652344, 6.121522426605225, 5.894323825836182, 5.979625225067139,
  5.802261829376221, 5.980832099914551, 6.157953262329102, 5.332640647888184,
  5.276951313018799, 5.32181453704834, 5.387034893035889, 5.243431568145752,
  5.285523414611816, 5.106122016906738, 4.894817352294922, 5.53544807434082,
  5.330514430999756, 5.229940414428711, 5.160070419311523, 4.970379829406738,
  6.319252014160156, 5.287144184112549, 5.467287063598633, 5.599654197692871,
  5.937978744506836, 6.397983074188232, 5.908963203430176, 5.33379602432251,
  6.041818618774414, 5.369903564453125, 5.653842449188232, 5.948474407196045,
  5.432162284851074, 4.648675441741943, 5.33964729309082, 5.267866611480713,
  4.583776473999023, 4.622270107269287, 4.880638122558594, 4.849315166473389,
  4.818880558013916, 4.7362284660339355, 5.407629013061523, 4.942767143249512,
  4.7012739181518555, 5.011561870574951, 5.013786792755127, 4.642846584320068,
  5.134769439697266, 5.122183322906494, 4.7708868980407715, 5.600433826446533,
  6.393815517425537, 6.449760913848877, 5.861471176147461, 6.76975679397583,
  6.957855701446533, 6.191672325134277, 4.990811347961426, 5.430092811584473,
  4.698286056518555, 5.054548740386963, 5.198452949523926, 4.4706902503967285,
  4.3060173988342285, 4.317348480224609, 4.590305328369141, 4.200551509857178,
  4.319252967834473, 4.29536247253418, 4.3752264976501465, 4.6434712409973145,
  4.780208587646484, 4.500317096710205, 5.041366100311279, 4.87997579574585,
  4.6528706550598145, 4.902865409851074, 5.7857489585876465, 5.132083892822266,
  5.08589506149292, 5.813236236572266, 5.773476600646973, 6.446902275085449,
  6.448231220245361, 6.46190071105957, 6.203192710876465, 6.177217960357666,
  5.824109077453613, 6.317103385925293,
];

// Unit Testing
test("curveExplainer", () => {
  const curveExplainer = jest.fn((patienceInter, train_loss, test_loss) => {
    var trainUpper = 0;
    var trainLower = 0;
    var testUpper = 0;
    var testLower = 0;

    const trainBollinger = boll(train_loss, patienceInter, 2);
    trainUpper = trainBollinger.upper;
    trainLower = trainBollinger.lower;

    const testBollinger = boll(test_loss, patienceInter, 2);
    testUpper = testBollinger.upper;
    testLower = testBollinger.lower;

    let tempArray = [];
    let minLoss = test_loss[0];
    let bestEpoch = 1;

    for (let i = 0; i < train_loss.length; i++) {
      if (i < patienceInter - 1) {
        if (test_loss[i] < minLoss) {
          minLoss = test_loss[i];
          bestEpoch = i + 1;
        }
      } else {
        if (test_loss[i] < trainBollinger.upper[i]) {
          if (test_loss[i] < minLoss) {
            minLoss = test_loss[i];
            bestEpoch = i + 1;
          }
        } else {
          let toBreak = true;
          for (let j = i + 1; j < i + 1 + patienceInter; j++) {
            if (
              test_loss[j] < minLoss &&
              test_loss[j] < trainBollinger.upper[j]
            ) {
              minLoss = test_loss[j];
              bestEpoch = j + 1;
              toBreak = false;
              i = j;
            } else {
              toBreak = true;
            }
          }
          if (toBreak === true) {
            break;
          }
        }
      }

      if (test_loss[i] < minLoss) {
        minLoss = test_loss[i];
        bestEpoch = i + 1;
      }
    }

    return bestEpoch;
  });

  // testing for the best epoch on 1st dataset with varying patience intervals of 5, 9, and 21 with 
  expect(curveExplainer(5, train_loss_1, test_loss_1)).toBe(16);
  expect(curveExplainer(9, train_loss_1, test_loss_1)).toBe(31);
  expect(curveExplainer(21, train_loss_1, test_loss_1)).toBe(65);

    // testing for the best epoch on 2nd dataset with varying patience intervals of 5, 9, and 21 with 
    // expect(curveExplainer(20, train_loss_2, test_loss_2)).toBe(31);
});
